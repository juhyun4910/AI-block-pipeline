{% extends "base.html" %}
{% block title %}AI 파이프라인 빌더 목업{% endblock %}
{% block content %}
<section class="hero">
  <div>
    <h1>드래그 앤 드랍 AI 파이프라인 빌더</h1>
    <p>
      비전공자도 문서 기반 RAG 파이프라인을 직관적으로 설계하고 배포할 수 있는 인터랙티브 목업입니다.
      좌측의 블록 라이브러리에서 노드를 끌어다 가운데 캔버스에 배치하고, 우측 속성 패널에서 세부 설정을
      실시간으로 조정할 수 있습니다.
    </p>
    <div class="hero-actions">
      <a class="btn primary" href="#builder">캔버스 살펴보기</a>
      <a class="btn secondary" href="/project-overview">프로젝트 설명 보기</a>
    </div>
  </div>
  <div class="hero-card">
    <h2>빠른 시작</h2>
    <ol>
      <li>템플릿을 불러오거나 빈 캔버스를 사용하세요.</li>
      <li>데이터 업로드 → 인덱싱 → 검색 → LLM → 가드 → 출력 순으로 블록을 연결하세요.</li>
      <li>샌드박스에서 질문을 테스트한 뒤, 배포 옵션을 선택하세요.</li>
    </ol>
  </div>
</section>

<section id="builder" class="builder-grid">
  <aside class="panel block-library">
    <h3>블록 라이브러리</h3>
    <p class="muted">필요한 블록을 캔버스로 드래그 앤 드랍하세요.</p>
    <div class="block-category" data-category="데이터">
      <h4>데이터 📁</h4>
      <div class="block-list">
        <button class="block-item" draggable="true" data-type="data" data-title="파일 업로드" data-description="MinIO · PDF, PPT, DOC 지원" data-config="s3_bucket=documents">
          파일 업로드
        </button>
        <button class="block-item" draggable="true" data-type="data" data-title="클라우드 드라이브" data-description="Google Drive, OneDrive 커넥터" data-config="sync_interval=6h">
          클라우드 드라이브
        </button>
        <button class="block-item" draggable="true" data-type="data" data-title="웹 크롤러" data-description="사이트 맵 기반 수집" data-config="max_depth=2">
          웹 크롤러
        </button>
      </div>
    </div>
    <div class="block-category" data-category="인덱싱">
      <h4>인덱싱 ⚙️</h4>
      <div class="block-list">
        <button class="block-item" draggable="true" data-type="index" data-title="텍스트 추출" data-description="PDF, DOCX, 이미지 OCR 지원" data-config="ocr=true">
          텍스트 추출
        </button>
        <button class="block-item" draggable="true" data-type="index" data-title="청크 생성" data-description="Chunk 800 / overlap 120" data-config="strategy=recursive">
          청크 생성
        </button>
        <button class="block-item" draggable="true" data-type="index" data-title="임베딩" data-description="nomic-embed-text · 768차원" data-config="batch_size=64">
          임베딩
        </button>
      </div>
    </div>
    <div class="block-category" data-category="검색">
      <h4>검색 🔍</h4>
      <div class="block-list">
        <button class="block-item" draggable="true" data-type="search" data-title="벡터 검색" data-description="pgvector · cosine similarity" data-config="top_k=5">
          벡터 검색
        </button>
        <button class="block-item" draggable="true" data-type="search" data-title="BM25" data-description="텍스트 랭킹 가중치" data-config="k1=1.2">
          BM25
        </button>
        <button class="block-item" draggable="true" data-type="search" data-title="하이브리드 재랭킹" data-description="BM25 + 임베딩 결합" data-config="re_ranker=colbert">
          하이브리드 재랭킹
        </button>
      </div>
    </div>
    <div class="block-category" data-category="LLM">
      <h4>LLM 💬</h4>
      <div class="block-list">
        <button class="block-item" draggable="true" data-type="llm" data-title="프롬프트 작성" data-description="근거 기반 가드레일 프롬프트" data-config="temperature=0.2">
          프롬프트 작성
        </button>
        <button class="block-item" draggable="true" data-type="llm" data-title="모델 선택" data-description="Ollama llama3.1:8b" data-config="max_tokens=512">
          모델 선택
        </button>
        <button class="block-item" draggable="true" data-type="llm" data-title="출력 포맷" data-description="JSON, Markdown, Text" data-config="format=markdown">
          출력 포맷
        </button>
      </div>
    </div>
    <div class="block-category" data-category="가드">
      <h4>가드 🛡️</h4>
      <div class="block-list">
        <button class="block-item" draggable="true" data-type="guard" data-title="PII 마스킹" data-description="이메일/전화번호 자동 마스킹" data-config="masking_level=high">
          PII 마스킹
        </button>
        <button class="block-item" draggable="true" data-type="guard" data-title="금칙어 필터" data-description="욕설/증오 발언 차단" data-config="policy=strict">
          금칙어 필터
        </button>
        <button class="block-item" draggable="true" data-type="guard" data-title="안전 정책" data-description="운영 정책 준수 지침" data-config="policy_version=v1.2">
          안전 정책
        </button>
      </div>
    </div>
    <div class="block-category" data-category="출력">
      <h4>출력 📦</h4>
      <div class="block-list">
        <button class="block-item" draggable="true" data-type="output" data-title="웹앱 배포" data-description="1클릭 배포 · 접근 제어" data-config="auth=rbac">
          웹앱 배포
        </button>
        <button class="block-item" draggable="true" data-type="output" data-title="위젯 코드" data-description="iframe · React 위젯 지원" data-config="auto_refresh=true">
          위젯 코드
        </button>
        <button class="block-item" draggable="true" data-type="output" data-title="API 엔드포인트" data-description="REST · gRPC 베타" data-config="rate_limit=60rpm">
          API 엔드포인트
        </button>
      </div>
    </div>
  </aside>

  <section class="canvas">
    <div class="canvas-header">
      <h3>파이프라인 캔버스</h3>
      <div class="canvas-actions">
        <button class="ghost" id="add-template">템플릿 불러오기</button>
        <button class="ghost" id="clear-canvas">초기화</button>
        <button class="ghost" id="auto-arrange">자동 정렬</button>
      </div>
    </div>
    <div class="canvas-body" id="pipeline-canvas" data-empty-text="블록을 끌어다 여기에 배치하세요.">
      <div class="canvas-empty" id="canvas-empty-state">
        <p>블록을 끌어다 여기에 배치하세요.</p>
        <p class="muted">템플릿을 불러오면 기본 파이프라인이 자동으로 구성됩니다.</p>
      </div>
    </div>
    <div class="sandbox">
      <h4>샌드박스 테스트</h4>
      <label for="question">질문</label>
      <textarea id="question" placeholder="예: 국내선 항공권 등급 제한?"></textarea>
      <label for="answer">예상 응답</label>
      <div id="answer" class="answer-preview">
        <p><strong>답변:</strong> 이용자는 국내선 경제석만 이용 가능하며, 업그레이드가 필요할 경우 사전 승인을 받아야 합니다.</p>
        <p class="evidence"><strong>근거:</strong> 여행 경비 규정 3.2.1 / 페이지 15</p>
      </div>
      <div class="sandbox-actions">
        <button class="primary">테스트 실행</button>
        <button class="ghost">로그 보기</button>
      </div>
    </div>
  </section>

  <aside class="panel inspector">
    <h3>속성 패널</h3>
    <div class="inspector-section">
      <h4>블록 정보</h4>
      <p class="muted">현재 선택: <strong id="inspector-selection">블록을 선택하세요</strong></p>
      <p id="inspector-description" class="inspector-description">캔버스에서 블록을 선택하면 상세 설명이 표시됩니다.</p>
    </div>
    <div class="inspector-section">
      <label for="config-text">구성 스니펫</label>
      <textarea id="config-text" readonly placeholder="block_config"></textarea>
    </div>
    <div class="inspector-section">
      <label>실행 메트릭</label>
      <ul class="metrics" id="inspector-metrics">
        <li>평균 지연: <strong>—</strong></li>
        <li>토큰 사용량: <strong>—</strong></li>
        <li>성공률: <strong>—</strong></li>
      </ul>
    </div>
    <div class="inspector-section">
      <h4>작업</h4>
      <button class="primary full-width" id="duplicate-node" disabled>블록 복제</button>
      <button class="secondary full-width" id="delete-node" disabled>블록 삭제</button>
    </div>
    <div class="inspector-section">
      <h4>배포 옵션</h4>
      <button class="primary full-width">웹앱 생성</button>
      <button class="secondary full-width">위젯 코드 복사</button>
      <button class="ghost full-width">API 엔드포인트 보기</button>
    </div>
  </aside>
</section>

<section class="callout">
  <h2>AI 파이프라인을 빠르게 실험하고 배포하세요.</h2>
  <p>
    로컬 무료 스택 기반으로 설계되어 교육 현장과 사내 PoC에 부담 없이 도입할 수 있습니다. 실제 기능 개발 전,
    사용자 여정과 인터페이스를 점검하는 용도로 활용하세요.
  </p>
</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', path='builder.js') }}" defer></script>
{% endblock %}

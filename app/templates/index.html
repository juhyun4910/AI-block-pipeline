{% extends "base.html" %}
{% block title %}드래그 앤 드롭 · RAG 파이프라인 빌더{% endblock %}
{% block content %}

<section class="hero">
  <div>
    <h1>드래그 앤 드롭 파이프라인 빌더</h1>
    <p>왼쪽에서 블록을 끌어 가운데 캔버스에 놓고, 오른쪽에서 설정을 바꿔 보세요.</p>
    <div class="hero-actions">
      <button id="auto-arrange" class="btn secondary">자동 정렬</button>
      <button id="clear-canvas" class="btn secondary">모두 지우기</button>
    </div>
  </div>
  <div class="hero-card template-callout">
    <h2 style="margin:0 0 8px 0;">템플릿</h2>
    <select id="template-selector">
      <option value="document-qa">문서 Q&A</option>
      <option value="regulation">규정/컴플라이언스</option>
    </select>
    <div class="template-actions">
      <button id="apply-template" class="btn primary">적용</button>
      <button class="template-pill" data-template="document-qa">Q&A</button>
      <button class="template-pill" data-template="regulation">규정</button>
    </div>
  </div>
</section>

<section class="builder-grid">
  <!-- Block Library -->
  <aside class="panel block-library">
    <h3>블록 라이브러리</h3>
    <p class="muted">아래 블록을 끌어 캔버스에 놓으세요.</p>

    <div class="block-category">
      <h4>입력/전처리</h4>
      <div class="block-list">
        <button class="block-item" draggable="true" data-type="data" data-title="문서 업로드" data-description="브라우저→MinIO 직업로드">
          문서 업로드
        </button>
        <button class="block-item" draggable="true" data-type="preprocess" data-title="전처리" data-description="정규화/언어감지/PII 마스킹">
          전처리
        </button>
      </div>
    </div>

    <div class="block-category">
      <h4>인덱싱/검색</h4>
      <div class="block-list">
        <button class="block-item" draggable="true" data-type="index" data-title="청크+임베딩" data-description="chunk 800 / overlap 120">
          청크+임베딩
        </button>
        <button class="block-item" draggable="true" data-type="search" data-title="검색" data-description="kNN 검색, threshold">
          검색
        </button>
      </div>
    </div>

    <div class="block-category">
      <h4>생성/가드</h4>
      <div class="block-list">
        <button class="block-item" draggable="true" data-type="llm" data-title="LLM 생성" data-description="Ollama 모델 호출">
          LLM 생성
        </button>
        <button class="block-item" draggable="true" data-type="guard" data-title="가드레일" data-description="PII 마스킹/금칙어">
          가드레일
        </button>
      </div>
    </div>

    <div class="block-category">
      <h4>출력/배포</h4>
      <div class="block-list">
        <button class="block-item" draggable="true" data-type="output" data-title="출력" data-description="웹/JSON">
          출력
        </button>
        <button class="block-item" draggable="true" data-type="deploy" data-title="배포" data-description="링크/위젯/API">
          배포
        </button>
      </div>
    </div>
  </aside>

  <!-- Canvas -->
  <section class="canvas panel">
    <div class="canvas-header">
      <h3 style="margin:0">파이프라인 캔버스</h3>
      <div class="canvas-actions">
        <button id="duplicate-node" class="btn secondary">복제</button>
        <button id="delete-node" class="btn secondary">삭제</button>
      </div>
    </div>
    <div class="canvas-body" id="pipeline-canvas">
      <svg id="edges-layer" class="edges-layer"></svg>
      <div id="canvas-empty-state" class="canvas-empty">
        왼쪽에서 블록을 끌어와서 배치하세요
      </div>
    </div>
  </section>

  <!-- Inspector -->
  <aside class="panel inspector">
    <h3>설정</h3>
    <div class="inspector-section">
      <div id="inspector-selection" class="muted">선택된 블록 없음</div>
      <p id="inspector-description" class="muted"></p>
    </div>

    <div id="inspector-metrics" class="inspector-section"></div>

    <div class="inspector-section">
      <h4>공통 설정</h4>
      <div id="inspector-common"></div>
    </div>

    <div class="inspector-section">
      <h4>블록별 설정</h4>
      <div id="inspector-specific"></div>
    </div>

    <div id="inspector-validation" class="validation muted"></div>
  </aside>
</section>

{% endblock %}
{% block scripts %}
  <script src="{{ url_for('static', path='builder.js') }}"></script>
  <script src="{{ url_for('static', path='ui.js') }}"></script>
{% endblock %}
